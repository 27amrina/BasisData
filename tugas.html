<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Studi Kasus SQL – Toko Buku (Bootstrap + JS) • Light</title>
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
    <style>
        :root {
            /* Palet putih–abu–biru */
            --clr-bg: #f6f8fb;
            /* latar sangat terang */
            --clr-surface: #ffffff;
            /* kartu putih */
            --clr-border: #e5e7eb;
            /* garis abu tipis */
            --clr-text: #0f172a;
            /* teks utama gelap */
            --clr-muted: #64748b;
            /* teks sekunder */
            --clr-primary: #0ea5e9;
            /* biru utama */
            --clr-primary-600: #0284c7;
            /* biru lebih gelap */
            --clr-primary-soft: #e6f4ff;
            /* latar aksen lembut */
            --shadow: 0 8px 30px rgba(2, 132, 199, .08);
            --radius: 1rem;
        }

        html,
        body {
            background: var(--clr-bg);
            color: var(--clr-text);
        }

        .navbar {
            background: linear-gradient(90deg, #eaf4ff 0%, #cfeaff 35%, #b3e1ff 100%);
            border-bottom: 1px solid var(--clr-border);
        }

        .navbar .logo {
            font-weight: 800;
            letter-spacing: .4px;
            color: var(--clr-primary-600);
        }

        .card {
            border: 1px solid var(--clr-border);
            border-radius: var(--radius);
            background: var(--clr-surface);
            box-shadow: var(--shadow);
        }

        .card-header {
            border-bottom: 1px solid var(--clr-border);
            background: linear-gradient(180deg, #ffffff 0%, #fbfdff 100%);
        }

        .form-control,
        .form-select,
        textarea.form-control {
            background: #fff;
            color: var(--clr-text);
            border-color: var(--clr-border);
        }

        .form-control:focus,
        .form-select:focus,
        textarea.form-control:focus {
            border-color: var(--clr-primary);
            box-shadow: 0 0 0 .25rem rgba(14, 165, 233, .25);
        }

        .badge-soft {
            background: var(--clr-primary-soft);
            color: var(--clr-primary-600);
            border: 1px solid #cfe8ff;
        }

        .required::after {
            content: " *";
            color: #ef4444;
        }

        .small-muted {
            color: var(--clr-muted);
            font-size: .96rem;
        }

        .task-title {
            color: #3b82f6;
        }

        .checklist .form-check-input:checked {
            background-color: #22c55e;
            border-color: #22c55e;
        }

        a,
        a:hover {
            color: var(--clr-primary-600);
        }

        /* Tombol tindakan bawah tetap terlihat */
        .sticky-actions {
            position: sticky;
            bottom: 0;
            z-index: 5;
            background: rgba(255, 255, 255, .9);
            backdrop-filter: blur(8px);
            border: 1px solid var(--clr-border);
            border-radius: var(--radius);
            box-shadow: 0 8px 24px rgba(15, 23, 42, .05);
        }

        /* Label kode */
        .code-label {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: .92rem;
            color: var(--clr-primary-600);
        }

        /* Progress badge */
        #progressPct {
            font-weight: 700;
        }

        /* Toast sederhana */
        .app-toast {
            position: fixed;
            top: 16px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1080;
            padding: .5rem .75rem;
            border-radius: .75rem;
            background: #ecfeff;
            color: #075985;
            border: 1px solid #bae6fd;
            box-shadow: var(--shadow);
        }

        /* Area cetak (PDF) tetap putih full kontras) */
        #printArea {
            background: #fff;
            color: #111827;
        }

        #printArea pre {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            border-radius: .75rem;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-light mb-4">
        <div class="container">
            <span class="navbar-brand d-flex align-items-center gap-2">
                <i class="bi bi-database-fill-gear text-primary"></i>
                <span class="logo">Studi Kasus SQL – Toko Buku</span>
            </span>
        </div>
    </nav>

    <main class="container pb-5">
        <!-- Hero / Instructions -->
        <div class="row g-4">
            <div class="col-12 col-lg-7">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-journal-text me-2 text-primary"></i>Deskripsi Studi Kasus</h5>
                    </div>
                    <div class="card-body small-muted">
                        <p><span class="badge badge-soft">Skenario</span></p>
                        <p>Sebuah platform <strong>Toko Buku Online</strong> membutuhkan database untuk mengelola data
                            <em>buku</em>, <em>kategori</em>, <em>pelanggan</em>, <em>pesanan</em>, dan <em>detail
                                pesanan</em>.
                            Anda diminta membuat skema database, mengelola data (tambah/ubah/hapus), dan melakukan query
                            dengan
                            <code>JOIN</code> serta <code>ORDER BY</code>.
                        </p>
                        <ul>
                            <li><strong>Entitas inti:</strong> <code>kategori</code>, <code>buku</code>,
                                <code>pelanggan</code>,
                                <code>pesanan</code>, <code>detail_pesanan</code>.
                            </li>
                            <li><strong>Relasi penting:</strong>
                                <ul>
                                    <li>Setiap <code>buku</code> memiliki satu <code>kategori</code> (FK:
                                        <code>buku.kategori_id</code> → <code>kategori.id</code>).
                                    </li>
                                    <li>Setiap <code>pesanan</code> dibuat oleh satu <code>pelanggan</code> (FK:
                                        <code>pesanan.pelanggan_id</code> → <code>pelanggan.id</code>).
                                    </li>
                                    <li><code>detail_pesanan</code> menyimpan item buku per pesanan (FK:
                                        <code>detail_pesanan.pesanan_id</code> dan <code>detail_pesanan.buku_id</code>).
                                    </li>
                                </ul>
                            </li>
                        </ul>
                        <p class="mb-0">Kerjakan sesuai urutan tugas. Jawaban berupa <strong>SQL</strong> pada setiap
                            bagian.
                            Simpan progres Anda dan unduh seluruh jawaban ke <strong>PDF</strong> ketika selesai.</p>
                        <hr class="my-3" />
                        <h6 class="mb-2"><i class="bi bi-diagram-3 me-2 text-primary"></i>Spesifikasi Skema & Data
                            Contoh
                            (Ditentukan)</h6>
                        <div class="small-muted">
                            <p><strong>Nama database:</strong> <code>db_tokobuku_2025</code></p>
                            <p><strong>Tabel:</strong> <code>kategori</code>, <code>buku</code>, <code>pelanggan</code>,
                                <code>pesanan</code>, <code>detail_pesanan</code>.
                            </p>
                            <details open class="mb-2">
                                <summary class="mb-1"><strong>DDL</strong></summary>
                                <pre class="mb-2"><code>-- MySQL
CREATE DATABASE db_tokobuku_2025;
USE db_tokobuku_2025;

CREATE TABLE kategori (
  id INT AUTO_INCREMENT PRIMARY KEY,
  nama VARCHAR(100) NOT NULL UNIQUE
);

CREATE TABLE buku (
  id INT AUTO_INCREMENT PRIMARY KEY,
  judul VARCHAR(150) NOT NULL,
  penulis VARCHAR(120) NOT NULL,
  harga INT NOT NULL,            -- akan diubah ke DECIMAL pada langkah ALTER
  stok INT NOT NULL DEFAULT 0,
  kategori_id INT NOT NULL
);

CREATE TABLE pelanggan (
  id INT AUTO_INCREMENT PRIMARY KEY,
  nama VARCHAR(120) NOT NULL,
  email VARCHAR(120) NOT NULL UNIQUE,
  telp VARCHAR(20)
);

CREATE TABLE pesanan (
  id INT AUTO_INCREMENT PRIMARY KEY,
  tanggal DATE NOT NULL,
  pelanggan_id INT NOT NULL
  );

CREATE TABLE detail_pesanan (
  id INT AUTO_INCREMENT PRIMARY KEY,
  pesanan_id INT NOT NULL,
  buku_id INT NOT NULL,
  jumlah INT NOT NULL,
  harga_saat_itu INT NOT NULL
);
</code></pre>
                            </details>
                            <details>
                                <summary class="mb-1"><strong>Data contoh (INSERT)</strong></summary>
                                <pre class="mb-0"><code>INSERT INTO kategori(nama) VALUES ('Fiksi'),('Teknologi'),('Bisnis');
-- Input data Buku
<img src="img/buku.png" class="img-fluid" alt="Responsive image">
-- Input data Detail Pesanan
<img src="img/detailpesanan.png" class="img-fluid" alt="Responsive image">
-- Input data Pelanggan
<img src="img/pelanggan.png" class="img-fluid" alt="Responsive image">
-- Input data Pesanan
<img src="img/pesanan.png" class="img-fluid" alt="Responsive image">
</code></pre>
                            </details>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-12 col-lg-5">
                <div class="card h-100">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-person-lines-fill me-2 text-primary"></i>Identitas Peserta</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-12">
                                <label class="form-label required">Nama</label>
                                <input id="fld_nama" type="text" class="form-control" placeholder="Nama lengkap"
                                    required />
                            </div>
                            <div class="col-6">
                                <label class="form-label">NIS</label>
                                <input id="fld_nim" type="text" class="form-control" placeholder="(opsional)" />
                            </div>
                            <div class="col-6">
                                <label class="form-label">Kelas</label>
                                <input id="fld_kelas" type="text" class="form-control" placeholder="(opsional)" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tasks -->
        <div class="row g-4 mt-1">
            <div class="col-12 col-xl-8">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="bi bi-list-check me-2 text-primary"></i>Tugas & Jawaban</h5>
                        <span class="small text-secondary">Gunakan SQL standar (MySQL/PostgreSQL diperbolehkan)</span>
                    </div>
                    <div class="card-body">
                        <ol class="ps-3" id="taskList">
                            <li class="mb-4">
                                <div class="d-flex align-items-center mb-2">
                                    <span class="task-title fw-semibold me-2">Buat database</span>
                                    <span class="badge badge-soft">CREATE DATABASE</span>
                                </div>
                                <label class="form-label code-label required">SQL:</label>
                                <textarea class="form-control" id="t1" rows="3" required></textarea>
                            </li>
                            <li class="mb-4">
                                <div class="d-flex align-items-center mb-2">
                                    <span class="task-title fw-semibold me-2">Buat tabel</span>
                                    <span class="badge badge-soft">CREATE TABLE & FK</span>
                                </div>
                                <p class="small-muted mb-2">Minimal tabel: <code>kategori</code>, <code>buku</code>,
                                    <code>pelanggan</code>, <code>pesanan</code>, <code>detail_pesanan</code>
                                </p>
                                <label class="form-label code-label required">SQL:</label>
                                <textarea class="form-control" id="t2" rows="10" required></textarea>
                            </li>
                            <li class="mb-4">
                                <div class="d-flex align-items-center mb-2">
                                    <span class="task-title fw-semibold me-2">Ubah field tabel</span>
                                    <span class="badge badge-soft">ALTER TABLE</span>
                                </div>
                                <p class="small-muted mb-2">Contoh: ubah tipe kolom <code>harga</code> pada tabel
                                    <code>buku</code>
                                    menjadi <code>DECIMAL(12,2)</code>.</p>
                                <label class="form-label code-label required">SQL:</label>
                                <textarea class="form-control" id="t3" rows="3" required></textarea>
                            </li>
                            <li class="mb-4">
                                <div class="d-flex align-items-center mb-2">
                                    <span class="task-title fw-semibold me-2">Tambahkan data</span>
                                    <span class="badge badge-soft">INSERT</span>
                                </div>
                                <p class="small-muted mb-2">Masukkan minimal <strong>5 buku</strong> dan <strong>3
                                        kategori</strong>.
                                </p>
                                <label class="form-label code-label required">SQL:</label>
                                <textarea class="form-control" id="t4" rows="8" required></textarea>
                            </li>
                            <li class="mb-4">
                                <div class="d-flex align-items-center mb-2">
                                    <span class="task-title fw-semibold me-2">Ubah data</span>
                                    <span class="badge badge-soft">UPDATE</span>
                                </div>
                                <p class="small-muted mb-2">Perbarui harga salah satu buku dan/atau pindahkan ke
                                    kategori lain.</p>
                                <label class="form-label code-label required">SQL:</label>
                                <textarea class="form-control" id="t5" rows="3" required></textarea>
                            </li>
                            <li class="mb-4">
                                <div class="d-flex align-items-center mb-2">
                                    <span class="task-title fw-semibold me-2">Hapus data yang tidak digunakan</span>
                                    <span class="badge badge-soft">DELETE</span>
                                </div>
                                <p class="small-muted mb-2">Hapus <code>kategori</code> yang tidak memiliki buku
                                    (pastikan aman
                                    terhadap FK).</p>
                                <label class="form-label code-label required">SQL:</label>
                                <textarea class="form-control" id="t6" rows="4" required></textarea>
                            </li>
                            <li class="mb-4">
                                <div class="d-flex align-items-center mb-2">
                                    <span class="task-title fw-semibold me-2">Tampilkan data</span>
                                    <span class="badge badge-soft">SELECT</span>
                                </div>
                                <p class="small-muted mb-2">Tampilkan daftar buku beserta nama kategori.</p>
                                <label class="form-label code-label required">SQL:</label>
                                <textarea class="form-control" id="t7" rows="3" required></textarea>
                            </li>
                            <li class="mb-4">
                                <div class="d-flex align-items-center mb-2">
                                    <span class="task-title fw-semibold me-2">JOIN</span>
                                    <span class="badge badge-soft">JOIN Multi-tabel</span>
                                </div>
                                <p class="small-muted mb-2">Tampilkan ringkas pesanan: <code>pesanan.id</code>,
                                    <code>tanggal</code>,
                                    <code>pelanggan.nama</code>, <code>total_item</code>.
                                </p>
                                <label class="form-label code-label required">SQL:</label>
                                <textarea class="form-control" id="t8" rows="6" required></textarea>
                            </li>
                            <li class="mb-2">
                                <div class="d-flex align-items-center mb-2">
                                    <span class="task-title fw-semibold me-2">ORDER BY</span>
                                    <span class="badge badge-soft">Sorting</span>
                                </div>
                                <p class="small-muted mb-2">Urutkan daftar buku dari harga <em>termahal</em> ke
                                    <em>termurah</em>.</p>
                                <label class="form-label code-label required">SQL:</label>
                                <textarea class="form-control" id="t9" rows="3" required></textarea>
                            </li>
                        </ol>
                    </div>
                </div>
            </div>

            <!-- Sidebar: Progress & Actions -->
            <div class="col-12 col-xl-4">
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h6 class="mb-0"><i class="bi bi-clipboard-check me-2 text-primary"></i>Progress</h6>
                        <span id="progressPct" class="badge text-bg-primary">0%</span>
                    </div>
                    <div class="card-body py-3">
                        <div class="checklist small">
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="c1" data-for="t1" />
                                <label class="form-check-label" for="c1">Buat database</label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="c2" data-for="t2" />
                                <label class="form-check-label" for="c2">Buat tabel</label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="c3" data-for="t3" />
                                <label class="form-check-label" for="c3">Ubah field tabel</label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="c4" data-for="t4" />
                                <label class="form-check-label" for="c4">Tambah data</label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="c5" data-for="t5" />
                                <label class="form-check-label" for="c5">Ubah data</label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="c6" data-for="t6" />
                                <label class="form-check-label" for="c6">Hapus data tak terpakai</label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="c7" data-for="t7" />
                                <label class="form-check-label" for="c7">Tampilkan data</label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="c8" data-for="t8" />
                                <label class="form-check-label" for="c8">JOIN</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="c9" data-for="t9" />
                                <label class="form-check-label" for="c9">ORDER BY</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card sticky-actions">
                    <div class="card-body d-grid gap-2">
                        <button id="btnSave" class="btn btn-info text-dark fw-semibold"><i
                                class="bi bi-save me-2"></i>Simpan Jawaban (Browser)</button>
                        <button id="btnPDF" class="btn btn-primary fw-semibold"><i
                                class="bi bi-filetype-pdf me-2"></i>Unduh Semua Jawaban (PDF)</button>
                        <button id="btnClear" class="btn btn-outline-danger"><i class="bi bi-trash3 me-2"></i>Hapus
                            Jawaban</button>
                        <div class="small-muted mt-2">Data disimpan secara lokal di <em>browser</em> (localStorage).
                            Anda bisa menutup dan kembali lagi tanpa kehilangan progres di perangkat yang sama.</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Hidden printable area -->
        <section id="printArea" class="d-none"></section>
    </main>

    <footer class="text-center text-secondary py-4 small">
        Dibuat dengan ❤️ menggunakan Bootstrap + JavaScript (client-side).
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- html2pdf.js (bundles html2canvas + jsPDF) -->
    <script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>
    <script>
        (function () {
            const KEY = 'studiKasusSQL_v1';
            const fieldIds = ['fld_nama', 'fld_nim', 'fld_kelas', 't1', 't2', 't3', 't4', 't5', 't6', 't7', 't8', 't9'];
            const checkIds = ['c1', 'c2', 'c3', 'c4', 'c5', 'c6', 'c7', 'c8', 'c9'];

            // Helpers
            const $ = (sel) => document.querySelector(sel);
            const byId = (id) => document.getElementById(id);

            function loadState() {
                const raw = localStorage.getItem(KEY);
                if (!raw) return;
                try {
                    const data = JSON.parse(raw);
                    fieldIds.forEach(id => { if (data[id] !== undefined) byId(id).value = data[id]; });
                    checkIds.forEach(id => { if (data[id] !== undefined) byId(id).checked = !!data[id]; });
                    updateProgress();
                } catch (e) { console.warn('Failed to parse saved state', e); }
            }

            function currentState() {
                const data = {};
                fieldIds.forEach(id => data[id] = byId(id).value.trim());
                checkIds.forEach(id => data[id] = byId(id).checked);
                return data;
            }

            function saveState() {
                const data = currentState();
                localStorage.setItem(KEY, JSON.stringify(data));
                toast('Jawaban tersimpan di browser.');
            }

            function clearState() {
                if (!confirm('Hapus semua jawaban yang tersimpan di browser ini?')) return;
                localStorage.removeItem(KEY);
                fieldIds.forEach(id => byId(id).value = '');
                checkIds.forEach(id => byId(id).checked = false);
                updateProgress();
                toast('Jawaban telah dihapus.');
            }

            function allFilled() {
                // Nama wajib + semua textarea wajib terisi
                const okNama = byId('fld_nama').value.trim().length > 0;
                const filledTextareas = ['t1', 't2', 't3', 't4', 't5', 't6', 't7', 't8', 't9'].every(id => byId(id).value.trim().length > 0);
                return okNama && filledTextareas;
            }

            function updateProgress() {
                const total = checkIds.length;
                const done = checkIds.filter(id => byId(id).checked).length;
                const pct = Math.round((done / total) * 100);
                byId('progressPct').textContent = pct + '%';
            }

            function toast(msg) {
                const el = document.createElement('div');
                el.className = 'app-toast';
                el.textContent = msg;
                document.body.appendChild(el);
                setTimeout(() => el.remove(), 1800);
            }

            function buildPrintable() {
                const data = currentState();
                const today = new Date();
                const tanggal = today.toLocaleString('id-ID', { dateStyle: 'full', timeStyle: 'short' });
                const section = byId('printArea');
                section.innerHTML = `
          <div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial; color:#111;">
            <h2 style="margin:0 0 6px 0;">Studi Kasus SQL – Toko Buku</h2>
            <div style="font-size:12px; color:#444; margin-bottom:16px;">Diunduh: ${tanggal}</div>
            <table style="width:100%; border-collapse: collapse; margin-bottom:16px; font-size:14px;">
              <tr>
                <td style="padding:6px 8px; border:1px solid #ddd; width:160px; font-weight:600;">Nama</td>
                <td style="padding:6px 8px; border:1px solid #ddd;">${escapeHtml(data['fld_nama'] || '')}</td>
              </tr>
              <tr>
                <td style="padding:6px 8px; border:1px solid #ddd; font-weight:600;">NIM/NIS</td>
                <td style="padding:6px 8px; border:1px solid #ddd;">${escapeHtml(data['fld_nim'] || '')}</td>
              </tr>
              <tr>
                <td style="padding:6px 8px; border:1px solid #ddd; font-weight:600;">Kelas</td>
                <td style="padding:6px 8px; border:1px solid #ddd;">${escapeHtml(data['fld_kelas'] || '')}</td>
              </tr>
            </table>
            ${[1, 2, 3, 4, 5, 6, 7, 8, 9].map(n => printBlock(n, data['t' + n] || '')).join('')}
          </div>
        `;
            }

            function printBlock(n, sql) {
                const titles = {
                    1: 'Buat database',
                    2: 'Buat tabel',
                    3: 'Ubah field tabel (ALTER TABLE)',
                    4: 'Tambahkan data (INSERT)',
                    5: 'Ubah data (UPDATE)',
                    6: 'Hapus data yang tidak digunakan (DELETE)',
                    7: 'Tampilkan data (SELECT)',
                    8: 'JOIN',
                    9: 'ORDER BY'
                };
                return `
          <div style="margin: 0 0 14px 0;">
            <div style="font-weight:700; margin-bottom:6px;">${n}. ${titles[n]}</div>
            <pre style="white-space: pre-wrap; word-wrap: break-word; background:#f8fafc; border:1px solid #e2e8f0; border-radius:8px; padding:10px; font-size:12.5px;">${escapeHtml(sql)}</pre>
          </div>`;
            }

            function escapeHtml(str) {
                return String(str)
                    .replaceAll('&', '&amp;')
                    .replaceAll('<', '&lt;')
                    .replaceAll('>', '&gt;');
            }

            async function downloadPDF() {
                if (!allFilled()) {
                    alert('Lengkapi minimal: Nama dan semua jawaban SQL sebelum mengunduh PDF.');
                    return;
                }
                buildPrintable();
                const opt = {
                    margin: [10, 10, 10, 10],
                    filename: `Jawaban_Studi_Kasus_SQL_${byId('fld_nama').value.trim().replace(/\s+/g, '_') || 'Peserta'}.pdf`,
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2, useCORS: true },
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                };
                const el = byId('printArea');
                el.classList.remove('d-none');
                await html2pdf().set(opt).from(el).save();
                el.classList.add('d-none');
            }

            // Wire events
            document.addEventListener('DOMContentLoaded', () => {
                loadState();
                // Sinkronkan checklist berdasarkan isi awal textarea
                ['t1', 't2', 't3', 't4', 't5', 't6', 't7', 't8', 't9'].forEach((id, idx) => {
                    const has = byId(id).value.trim().length > 0;
                    byId('c' + (idx + 1)).checked = has;
                });
                updateProgress();
                // auto-checklist: check when textarea gets content
                ['t1', 't2', 't3', 't4', 't5', 't6', 't7', 't8', 't9'].forEach((id, idx) => {
                    byId(id).addEventListener('input', () => {
                        byId('c' + (idx + 1)).checked = byId(id).value.trim().length > 0;
                        updateProgress();
                    });
                });
                // manual checks also update progress
                checkIds.forEach(cid => byId(cid).addEventListener('change', updateProgress));
                byId('btnSave').addEventListener('click', saveState);
                byId('btnClear').addEventListener('click', clearState);
                byId('btnPDF').addEventListener('click', downloadPDF);
            });
        })();
    </script>
</body>

</html>